"use strict";
var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
Object.defineProperty(exports, "__esModule", { value: true });
var child_process_1 = require("child_process");
var chokidar_1 = __importDefault(require("chokidar"));
var chalk_1 = __importDefault(require("chalk"));
var path_1 = __importDefault(require("path"));
/**
 * Watch core package src directory only if it's not inside node_modules.
 */
function watchCorePkg(corePkgInfo) {
    var watcher = chokidar_1.default.watch([]);
    var srcDir = path_1.default.resolve(corePkgInfo.dir, "src");
    if (srcDir.match(/node_modules/) === null) {
        watcher.add("".concat(srcDir, "/**/*"));
    }
    watcher.on("change", function (path) {
        if (path.includes(srcDir)) {
            try {
                (0, child_process_1.exec)("tsc", { cwd: corePkgInfo.dir }, function (err, stdout, stderr) {
                    var hasError = false;
                    if (err) {
                        hasError = true;
                        console.log(chalk_1.default.red(err.message));
                    }
                    if (stderr) {
                        hasError = true;
                        console.log(chalk_1.default.red("stderr: ".concat(stderr)));
                    }
                    if (stdout && hasError) {
                        console.log(chalk_1.default.red(stdout));
                    }
                });
            }
            catch (err) {
                console.log(err);
            }
        }
    });
}
exports.default = watchCorePkg;
//# sourceMappingURL=watchCorePkg.js.map